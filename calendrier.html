<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendrier des Groupes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            margin: 0;
        }
        .container {
            display: flex;
            width: 100%;
            height: 100vh;
        }
        .left {
            flex: 3;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #ddd;
        }
        .right {
            flex: 1;
            padding: 20px;
            background: #f9f9f9;
        }
        .group-selector {
            margin-bottom: 20px;
        }
        h3 {
            margin-top: 0;
        }
        #events {
            margin-top: 20px;
        }
    </style>
    <script>
        fetch("php/get_groups.php")
            .then(response => response.text())
            .then(options => {
                document.getElementById("group").innerHTML = options;
            });
    </script>
</head>
<body>
    <div class="container">
        <div class="left">
            <h2>Événements</h2>
            <div id="events">
                <p>Sélectionnez un groupe et une date pour afficher les événements.</p>
            </div>
        </div>
        <div class="right">
            <h3>Choisissez une date et un groupe</h3>
            <div class="group-selector">
                <label for="group">Groupe :</label>
                <select id="group">
                    <!-- Les options seront ajoutées dynamiquement via PHP -->
                </select>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Initialise le calendrier Flatpickr
        flatpickr("#date", {
            dateFormat: "Y-m-d",
            onChange: function(selectedDates, dateStr) {
                updateEvents();
            }
        });

        const groupSelector = document.getElementById("group");
        const eventsContainer = document.getElementById("events");

        // Charger dynamiquement les options de groupe depuis get_groups.php
        fetch("php/get_groups.php")
            .then(response => response.text())
            .then(options => {
                groupSelector.innerHTML = options;
            });

        // Mettre à jour les événements lorsque le groupe est sélectionné
        groupSelector.addEventListener("change", () => {
            const group = groupSelector.value; // Contient directement "11A", "11B", etc.

            if (group) {
                fetch(`php/get_events.php?group=${group}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length === 0) {
                            eventsContainer.innerHTML = `<p>Aucun événement trouvé pour ce groupe.</p>`;
                        } else {
                            eventsContainer.innerHTML = data
                                .map(event => `<p>${event.date} ${event.time} - ${event.summary}</p>`)
                                .join("");
                        }
                    });
            }
        });

    </script>
</body>
</html>